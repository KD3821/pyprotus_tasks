# log_analyzer

<h1 align="center">Log Analyzer (анализатор логов)</h1>
<p align="center"><img src="https://img.shields.io/badge/made_by-KD3821-lightblue"></p>

<b>Описание работы анализатора</b><br>
<ul>
<li>
count - сĸольĸо раз встречается URL, абсолютное значение</li>
<li>
count_perc - сĸольĸо раз встречается URL, в процентнах относительно общего числа запросов</li>
<li>
time_sum - суммарный $request_time для данного URL'а, абсолютное значение</li>
<li>
time_perc - суммарный $request_time для данного URL'а, в процентах относительно общего $request_time всех запросов</li>
<li>
time_avg - средний $request_time для данного URL'а</li>
<li>
time_max - маĸсимальный $request_time для данного URL'а</li>
<li>
time_med - медиана $request_time для данного URL'а</li></ul>


<p align="center"><img src="https://github.com/kd3821/pyprotus_tasks/blob/main/img/report-2023.12.16.png?raw=true"></p>


<b>Краткая инструкция по работе с анализатором лога</b><br><br>

<ul>
  <li>Создать файл конфигурации 'config.json' в той же директории. </li>
  <li>Задать порог валидности логов (fail_coefficient), при котором анализ будет остановлен (по-умолчанию задано 20 %). </li>
  <li>Запустить анализатор командой: python3 log_analyzer.py --config=config.json</li>
  <li>Для запуска тестов использовать команду: python3 -m unittest test_analyzer.Testing</li>
  <li>Для отображения HTML-шаблона с анализом логов понадобится 'jquery.tablesorter.min.js'</li>
</ul><br>

<p>
Если файл конфигурации не будет найден, или будет пустой - применятся настройки по-умолчанию.<br>
В случае отсутствия какого-либо необходимого параметра в файле конфигурации, этот параметр будет взят из настройки
по-умолчанию.<br>Если не указан файл для логирования работы анализатора - логирование выводится в stdout.</p>
<br><br>
<p>Файл HTML-шаблона (report.html) для просмотра результатов анализа должен находится в одной директории с файлом анализатора.<br>
(Скачать 'jquery.tablesorter.min.js' можно тут: https://www.cdnpkg.com/jquery.tablesorter/file/jquery.tablesorter.min.js/)</p>
<br><br>
<p>
Для проверки работы рекомендуется поочередно переименовывать файлы с логами на имена с поздней <br>
датой (например '*-20231218') и затем запускать анализатор.
<br>(В этом репозитории две папки с отчетами: 'reports' и 'reports2') - так как они разные в настройках по-умолчанию и в файле 'config.json'.</p>
<br><br>

<p>Описание наборов логов в папке 'log':</p>

<table>
<thead>
<tr>
  <th>Файл</th>
  <th>Кол-во логов</th>
  <th>% Невалидных</th>
  <th>Время анализа</th>
  <th>Размер файла</th>
</tr>
</thead>
<tbody>
<tr>
  <td>nginx-access-ui.log-20170626</td>
  <td>5000</td>
  <td>0.02 %</td>
  <td>50.478 секунд</td>
  <td>1.1 MB</td>
</tr>
<tr>
  <td>nginx-access-ui.log-20170627</td>
  <td>100</td>
  <td>39.00 %</td>
  <td>0.007 секунд</td>
  <td>22.0 kB</td>
</tr>
<tr>
  <td>nginx-access-ui.log-20170628</td>
  <td>2500</td>
  <td>0.00 %</td>
  <td>11.67 секунд</td>
  <td>547.0 kB</td>
</tr>
<tr>
  <td>nginx-access-ui.log-20170629</td>
  <td>10000</td>
  <td>9.75 %</td>
  <td>3.347 секунд</td>
  <td>2.1 MB</td>
</tr>
<tr>
  <td>nginx-access-ui.log-20231216</td>
  <td>20</td>
  <td>25.00 %</td>
  <td>0.004 секунд</td>
  <td>4.3 kB</td>
</tr>
<tr>
  <td>nginx-access-ui.log-20231217</td>
  <td>20</td>
  <td>0.00 %</td>
  <td>0.004 секунд</td>
  <td>4.3 kB</td>
</tr>
<tr>
  <td>nginx-access-other.log-20231218</td>
  <td>20</td>
  <td>0.00 %</td>
  <td>0.004 секунд</td>
  <td>27.8 kB</td>
</tr>
</tbody>
</table>
<br>
Примечание:
<ul>
<li>
Скорость анализа логов зависит от соотношения кол-ва уникальных логов к общему их кол-ву<br>
(например анализ 10000 повторяющихся логов происходит в 3 раза быстрее анализа 2500 уникальных).</li>
<li>
Для запуска тестов используются те же наборы логов что и в файлах *.log-20231216 и *.log-20231217 в таблице.</li>
<li>
Учебный архив с более чем 2600000 логов проанализирован не был - по грубым подсчетам время работы анализатора составит 2-3 часа.</li>
</ul>
